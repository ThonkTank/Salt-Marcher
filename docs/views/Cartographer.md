# Cartographer

> **Lies auch:** [Map-Feature](../features/Map-Feature.md), [Map](../entities/map.md), [Terrain](../entities/terrain-definition.md), [Path.md](../entities/path.md), [Dungeon-System.md](../features/Dungeon-System.md)
> **Konsumiert:** Map

Der Karten-Editor fuer Hex-Overland und Grid-Dungeon Maps.

**Pfad:** `src/application/cartographer/`

---

## Uebersicht

Der Cartographer ist der zentrale Map-Editor mit kontextabhaengigen Tools je nach Map-Typ:

| Map-Typ | Koordinaten | Primaere Tools |
|---------|-------------|----------------|
| **Overland** | Hex (axial) | Terrain, Elevation, Climate, Features |
| **Dungeon** | Grid (5ft) | Waende, Tueren, Fallen, Tokens |

---

## Empfohlener Workflow (Overland)

Der typische Workflow fuer die Erstellung einer Overland-Karte:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. TERRAIN MALEN (grob)                                            â”‚
â”‚     â†’ Terrain-Brush: Vordefinierte Terrains platzieren              â”‚
â”‚     â†’ Grosse Brush-Size fuer schnelles Malen                        â”‚
â”‚                                                                      â”‚
â”‚  2. ÃœBERGÃ„NGE SMOOTHEN                                              â”‚
â”‚     â†’ Smooth-Transitions-Tool: Elevation, Temp, Precipitation       â”‚
â”‚     â†’ Nur an Terrain-Grenzen, Weighted Average                      â”‚
â”‚                                                                      â”‚
â”‚  3. DETAIL-LAYER ANPASSEN                                           â”‚
â”‚     â†’ Elevation-Brush: Berge, Taeler, Klippen                       â”‚
â”‚     â†’ Climate-Brush: Lokale Overrides (kalter Sumpf, heisse Oase)  â”‚
â”‚     â†’ Location-Marker: POIs platzieren                              â”‚
â”‚                                                                      â”‚
â”‚  4. DERIVED-DATEN BERECHNEN (Button-Click)                          â”‚
â”‚     â†’ Calculate-Derived-Tool: Water, Wind Shadow, Forest, Desert   â”‚
â”‚     â†’ Preview â†’ Apply                                               â”‚
â”‚                                                                      â”‚
â”‚  5. FEINSCHLIFF                                                     â”‚
â”‚     â†’ Inspector: Einzelne Tiles anpassen                            â”‚
â”‚     â†’ Path-Tool: Strassen, Fluesse (Post-MVP)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Vorteile:**
- **Schnell:** Grobes Malen zuerst, Details spaeter
- **Konsistent:** Automatische Berechnungen fuer realistische Klima-Effekte
- **Reversibel:** TileClimateModifiers koennen jederzeit entfernt werden

---

## Layout-Wireframe

### Standard-Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â‰¡] Cartographer          â”‚ Map: Silverwood Region    â”‚ [ğŸ’¾] [â†©] [â†ª] [âš™ï¸]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚TOOLS   â”‚  â”‚                                                              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                                                              â”‚â”‚
â”‚  â”‚ [ğŸ–Œï¸]  â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ [â›°ï¸]  â”‚  â”‚                      MAP CANVAS                              â”‚â”‚
â”‚  â”‚ [ğŸŒ¡ï¸]  â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ [ğŸŒ²]  â”‚  â”‚                    (Hex/Grid View)                           â”‚â”‚
â”‚  â”‚ [ğŸ“]  â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ [ğŸ‘ï¸]  â”‚  â”‚                                                              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                                                              â”‚â”‚
â”‚  â”‚LAYERS  â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ â˜‘ï¸ Ter â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ â˜‘ï¸ Elevâ”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ â˜ Clim â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚ â˜ Fact â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  TOOL OPTIONS (kontextabhaengig)                             â”‚â”‚
â”‚              â”‚  [Tool-spezifische Optionen hier]                            â”‚â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tool-Legende

| Icon | Tool | Map-Typ | Status |
|------|------|---------|--------|
| ğŸ–Œï¸ | Terrain-Brush | Overland | MVP |
| â›°ï¸ | Elevation-Brush | Overland | MVP |
| ğŸŒ¡ï¸ | Climate-Brush | Overland | Post-MVP |
| â˜ ï¸ | Danger-Zone-Brush | Overland | MVP |
| ğŸ”„ | Smooth-Transitions | Overland | Post-MVP |
| âš¡ | Calculate-Derived | Overland | Post-MVP |
| ğŸ›¤ï¸ | Path-Tool | Overland | Post-MVP |
| ğŸ“ | Location-Marker | Overland | MVP |
| ğŸ‘ï¸ | Inspector | Alle | MVP |
| ğŸ§± | Wall-Tool | Dungeon | MVP |
| ğŸšª | Door-Tool | Dungeon | MVP |
| âš ï¸ | Trap-Tool | Dungeon | Post-MVP |
| ğŸ¯ | Token-Placer | Dungeon | MVP |

---

## Tool-Panels

### Terrain-Brush (Overland)

Malt Terrain-Typen auf Hex-Tiles.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–Œï¸ TERRAIN BRUSH                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Terrain                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸŒ²   â”‚ â”‚ ğŸ”ï¸   â”‚ â”‚ ğŸŒ¾   â”‚        â”‚
â”‚  â”‚Forestâ”‚ â”‚Mount.â”‚ â”‚Plainsâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸœï¸   â”‚ â”‚ ğŸŒŠ   â”‚ â”‚ ğŸŒ¿   â”‚        â”‚
â”‚  â”‚Desertâ”‚ â”‚Water â”‚ â”‚Swamp â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  [+ Custom...]                       â”‚
â”‚                                      â”‚
â”‚  Brush Size                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [1] [2] [â—3] [4] [5]               â”‚
â”‚                                      â”‚
â”‚  Brush Shape                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Circle] [â—‹ Line] [â—‹ Fill]       â”‚
â”‚                                      â”‚
â”‚  Options                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â˜ Auto-Elevation (â†• anpassen)      â”‚
â”‚  â˜ Preview Mode                      â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Interaktionen:**
- Linksklick + Drag: Terrain malen
- Rechtsklick: Terrain-Picker (von Tile uebernehmen)
- Shift + Klick: Gerade Linie zum letzten Punkt

### Elevation-Brush (Overland)

Kontrolliert Hoehenwerte fuer Terrain.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â›°ï¸ ELEVATION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Mode                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Paint] [â—‹ Gradient] [â—‹ Smooth]  â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Paint Mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Elevation: [====â—=====] 1250m      â”‚
â”‚  Min: 0m              Max: 4000m    â”‚
â”‚                                      â”‚
â”‚  Presets                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [Sea 0] [Low 250] [Mid 750]        â”‚
â”‚  [High 1500] [Peak 3000]            â”‚
â”‚                                      â”‚
â”‚  Brush Size                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [1] [â—2] [3] [4] [5]               â”‚
â”‚                                      â”‚
â”‚  Strength                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [=======â—===] 75%                  â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Gradient Mode â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Start: [====â—=====] 500m           â”‚
â”‚  End:   [========â—==] 1800m         â”‚
â”‚                                      â”‚
â”‚  Falloff: [â— Linear] [â—‹ Smooth]     â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Smooth Mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Iterations: [1] [â—2] [3]           â”‚
â”‚  Preserve Peaks: â˜‘ï¸                  â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Modi:**
- **Paint**: Direktes Setzen von Hoehenwerten
- **Gradient**: Zeichnet Gradient zwischen zwei Punkten
- **Smooth**: Glaettet Uebergaenge zwischen Hoehen

### Climate-Brush (Overland)

Ueberschreibt berechnete Klimawerte lokal. Erstellt `TileClimateModifiers` auf Tile-Level.

â†’ Schema: [terrain-definition.md#terrainweatherranges](../entities/terrain-definition.md#terrainweatherranges)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ¡ï¸ CLIMATE OVERRIDE                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Layer                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Temp] [â—‹ Precip] [â—‹ Wind] [â—‹ Fog]â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Temperature â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Override: [===â—======] +5Â°C        â”‚
â”‚  Range: -20Â°C to +20Â°C              â”‚
â”‚                                      â”‚
â”‚  Mode                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Additive] [â—‹ Absolute]          â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Precipitation â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Override: [=======â—==] +30%        â”‚
â”‚  Range: -50% to +100%               â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Wind â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Exposure: [sheltered] [â—normal] [exposed]â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Fog â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Override: [=======â—==] +25%        â”‚
â”‚  Range: -50% to +100%               â”‚
â”‚                                      â”‚
â”‚  Brush                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Size: [1] [2] [â—3] [4] [5]         â”‚
â”‚  Falloff: [======â—===] 70%          â”‚
â”‚                                      â”‚
â”‚  [Clear Selection] [Clear All]       â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Layer-Beschreibung:**

| Layer | Parameter | Speicherung |
|-------|-----------|-------------|
| **Temp** | `temperatureModifier` | TileClimateModifiers |
| **Precip** | `humidityModifier` | TileClimateModifiers |
| **Wind** | `windExposure` | TileClimateModifiers |
| **Fog** | `humidityModifier` (beeinflusst fogChance) | TileClimateModifiers |

**Hinweis:** Fog und Precip teilen sich `humidityModifier` - erhoehte Humidity erhoeht sowohl Niederschlag als auch Nebel.

### Danger-Zone-Brush (Overland)

Setzt die Gefahrenstufe fuer automatische Encounter-Generierung. Die Danger-Zone bestimmt das CR-Budget eines Hexes.

â†’ Schema: [Map.md#danger-zones-und-cr-budget](../entities/map.md#danger-zones-und-cr-budget)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜ ï¸ DANGER ZONE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Zone-Stufe                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ğŸŸ¢   â”‚ â”‚ ğŸŸ¡   â”‚                  â”‚
â”‚  â”‚ Safe â”‚ â”‚Normalâ”‚ â† default        â”‚
â”‚  â”‚ CR 5 â”‚ â”‚CR 15 â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ğŸŸ    â”‚ â”‚ ğŸ”´   â”‚                  â”‚
â”‚  â”‚Dangerâ”‚ â”‚Deadlyâ”‚                  â”‚
â”‚  â”‚CR 30 â”‚ â”‚CR 50 â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                      â”‚
â”‚  Brush Size                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [1] [â—2] [3] [4] [5]               â”‚
â”‚                                      â”‚
â”‚  Options                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â˜ Show Zone Overlay                â”‚
â”‚  â˜ Show CR Budget                   â”‚
â”‚                                      â”‚
â”‚  [Clear Selection]                   â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Zone-Stufen:**

| Zone | CR-Budget | Farbe | Typische Verwendung |
|------|-----------|-------|---------------------|
| **Safe** | 5 | Gruen | Staedte, Lager, Schutzgebiete |
| **Normal** | 15 | Gelb | Standard-Wildnis (Default) |
| **Dangerous** | 30 | Orange | Monster-Territorien, Grenzlaender |
| **Deadly** | 50 | Rot | Drachen-Lande, verfluchte Zonen |

**Overlay-Darstellung:**

Wenn "Show Zone Overlay" aktiviert ist, werden Hexes entsprechend ihrer Danger-Zone eingefaerbt:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚      ğŸŸ¢        ğŸŸ¡        ğŸŸ¡        ğŸŸ                â”‚
â”‚   Safe      Normal    Normal    Danger             â”‚
â”‚      ğŸŸ¡        ğŸ”´        ğŸŸ         ğŸŸ                â”‚
â”‚   Normal    Deadly    Danger    Danger             â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CR-Budget-Anzeige:**

Wenn "Show CR Budget" aktiviert ist, zeigt jedes Hex sein verfuegbares Budget:

- Basis-Budget (aus Danger-Zone)
- Verbrauch durch Fraktionen (crSpent)
- Verfuegbares Budget (Differenz)

â†’ Details: [Map.md](../entities/map.md#cr-budget-berechnung)

### Smooth-Transitions-Tool (Overland)

Glaettet Uebergaenge an Terrain-Grenzen.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”„ SMOOTH TRANSITIONS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Layers                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â˜‘ï¸ Elevation                        â”‚
â”‚  â˜‘ï¸ Temperature                      â”‚
â”‚  â˜‘ï¸ Humidity/Precipitation           â”‚
â”‚  â˜ Wind Exposure                     â”‚
â”‚                                      â”‚
â”‚  Strength                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [====â—=====] 50%                   â”‚
â”‚                                      â”‚
â”‚  Scope                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Selection] [â—‹ All Borders]      â”‚
â”‚                                      â”‚
â”‚  [Apply to Selection] [Apply to All] â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Algorithmus:** Weighted Average an Terrain-Grenzen

```typescript
function smoothAtBorder(tile: Tile, neighbors: Tile[]): number {
  let weightedSum = tile.value;
  let totalWeight = 1;

  for (const neighbor of neighbors) {
    if (neighbor.terrain !== tile.terrain) {
      const weight = 0.5;  // Nachbar-Gewicht
      weightedSum += neighbor.value * weight;
      totalWeight += weight;
    }
  }

  return weightedSum / totalWeight;
}
```

**Anwendung:**
- Nur an **Terrain-Grenzen** (nicht mitten im Terrain)
- Glaettet harte Uebergaenge (z.B. Wald -10Â°C â†’ Wueste +40Â°C)
- Ergebnis wird in `TileClimateModifiers` gespeichert

### Calculate-Derived-Tool (Overland)

Berechnet abgeleitete Klima-Werte aus Terrain-Einfluessen.

â†’ Terrain-Einfluss-Werte: [Weather.md](../services/Weather.md)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ CALCULATE DERIVED                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Effects                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â˜‘ï¸ Water influence (temp, precip)   â”‚
â”‚  â˜‘ï¸ Mountain wind shadow             â”‚
â”‚  â˜‘ï¸ Forest humidity                  â”‚
â”‚  â˜‘ï¸ Desert heat radiation            â”‚
â”‚  â˜‘ï¸ Elevation â†’ Temperature          â”‚
â”‚                                      â”‚
â”‚  Mode                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Preview] [â—‹ Apply directly]     â”‚
â”‚                                      â”‚
â”‚  [Calculate]                         â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Affected tiles: 127                 â”‚
â”‚  Avg temp change: -2.3Â°C            â”‚
â”‚  Avg precip change: +8%              â”‚
â”‚                                      â”‚
â”‚  [Apply Changes] [Discard]           â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Berechnete Effekte:**

| Effekt | Quelle | Radius | Auswirkung |
|--------|--------|--------|------------|
| Water influence | water Terrain | 2 Tiles | -3Â°C temp, +10% precip |
| Mountain wind shadow | mountains | 3 Tiles | Ã—0.5 wind (Leeseite) |
| Forest humidity | forest | 1 Tile | +15% humidity |
| Desert heat | desert | 2 Tiles | +5Â°C temp, -20% precip |
| Elevationâ†’Temp | tile.elevation | - | -6.5Â°C / 1000m |

**Persistierung:** Ergebnisse werden in `TileClimateModifiers` gespeichert. Urspruengliche Terrain-Werte bleiben unveraendert.

**Workflow:**
1. **Preview**: Zeigt betroffene Tiles und durchschnittliche Aenderungen
2. **Apply**: Schreibt Ergebnisse in die Tiles
3. **Rueckgaengig**: Tile.climateModifiers loeschen setzt auf Terrain-Default zurueck

### Path-Tool (Overland) (Post-MVP)

Zeichnet lineare Features (Strassen, Fluesse, Schluchten, Klippen) zwischen Hex-Zentren.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›¤ï¸ PATH TOOL                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Path Type                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ â•â•â•  â”‚ â”‚ ~~~  â”‚ â”‚ ///  â”‚        â”‚
â”‚  â”‚ Road â”‚ â”‚River â”‚ â”‚Ravineâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ â–²â–²â–²  â”‚ â”‚ ---  â”‚                  â”‚
â”‚  â”‚Cliff â”‚ â”‚Trail â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                      â”‚
â”‚  Mode                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Draw] [â—‹ Extend] [â—‹ Delete]     â”‚
â”‚                                      â”‚
â”‚  Properties (selected path)          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Name: [________________]            â”‚
â”‚  Speed Modifier: [====â—====] 1.3    â”‚
â”‚                                      â”‚
â”‚  â˜ Blocks Movement (barrier)         â”‚
â”‚  â˜ Requires Transport: [Boot â–¼]     â”‚
â”‚                                      â”‚
â”‚  Encounter                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â˜ Custom Creature Pool              â”‚
â”‚  [+ Add Creature...]                 â”‚
â”‚                                      â”‚
â”‚  [+ Custom Path Type...]             â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Interaktionen:**

| Aktion | Funktion |
|--------|----------|
| Click + Drag | Pfad zeichnen (Hex-zu-Hex Verbindungen) |
| Click auf Pfad-Endpunkt | Pfad verlaengern |
| Right-Click auf Pfad | Pfad loeschen |
| Inspector | Pfad-Details bearbeiten |

**Rendering:**

Pfade werden als Linien zwischen Hex-Zentren gezeichnet:
- Terrain wird zuerst gerendert
- Pfade werden ueber dem Terrain gezeichnet
- POIs und Party-Token werden zuletzt gerendert

> Schema-Details: [Path.md](../entities/path.md)

### Location-Marker (Overland)

Platziert POIs und Locations auf der Karte.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ LOCATION MARKER                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Type                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Settlement] [â—‹ Dungeon]         â”‚
â”‚  [â—‹ Landmark]   [â—‹ Custom]          â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Settlement â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸ    â”‚ â”‚ ğŸ˜ï¸   â”‚ â”‚ ğŸ°   â”‚        â”‚
â”‚  â”‚Villageâ”‚ â”‚ Town â”‚ â”‚ City â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Dungeon â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸ•³ï¸   â”‚ â”‚ ğŸšï¸   â”‚ â”‚ â›ï¸   â”‚        â”‚
â”‚  â”‚ Cave â”‚ â”‚Ruins â”‚ â”‚ Mine â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Landmark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸŒ³   â”‚ â”‚ â›°ï¸   â”‚ â”‚ ğŸ—¼   â”‚        â”‚
â”‚  â”‚Tree  â”‚ â”‚Peak  â”‚ â”‚Tower â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                      â”‚
â”‚  On Place                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â˜‘ï¸ Open Location Editor             â”‚
â”‚  â˜ Link to existing Location        â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Inspector (Alle Map-Typen)

Zeigt Details zum ausgewaehlten Tile/Element.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘ï¸ INSPECTOR                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Selected: Hex (12, 8)               â”‚
â”‚                                      â”‚
â”‚  Terrain                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Type: Forest                        â”‚
â”‚  Movement Cost: 0.6                  â”‚
â”‚  [Change Terrain...]                 â”‚
â”‚                                      â”‚
â”‚  Elevation                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Height: 750m                        â”‚
â”‚  Slope: Moderate (NE)                â”‚
â”‚  [Edit Elevation...]                 â”‚
â”‚                                      â”‚
â”‚  Climate (Derived)                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Base Temp: 14Â°C                     â”‚
â”‚  Override: +2Â°C                      â”‚
â”‚  Precipitation: Normal               â”‚
â”‚  [Edit Override...]                  â”‚
â”‚                                      â”‚
â”‚  Features                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ Dense Forest                      â”‚
â”‚  â€¢ Ancient Ruins                     â”‚
â”‚  [+ Add Feature] [- Remove]          â”‚
â”‚                                      â”‚
â”‚  Locations                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ Silverwood Village [â†’]            â”‚
â”‚  [+ Add Location]                    â”‚
â”‚                                      â”‚
â”‚  Factions                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ Elven Council (75%)               â”‚
â”‚  â€¢ Bandits (15%)                     â”‚
â”‚                                      â”‚
â”‚  Encounter Budget                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Danger Zone: [Normal â–¼]            â”‚
â”‚  CR Budget:   15                     â”‚
â”‚  CR Spent:    3.5 (by factions)      â”‚
â”‚  CR Available: 11.5                  â”‚
â”‚  [Edit Zone...]                      â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Encounter Budget Details:**

| Feld | Beschreibung |
|------|--------------|
| **Danger Zone** | Dropdown: Safe/Normal/Dangerous/Deadly |
| **CR Budget** | Basis-Budget aus Danger-Zone (oder manueller Override) |
| **CR Spent** | Berechnet aus: Î£(faction.strength Ã— faction.presence) |
| **CR Available** | Budget - Spent (fuer neue Encounters verfuegbar) |

**Edit Zone Dialog:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edit Encounter Budget               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Danger Zone: [Normal â–¼]            â”‚
â”‚                                      â”‚
â”‚  â˜ Manual CR Override               â”‚
â”‚  CR Budget: [   15   ]              â”‚
â”‚                                      â”‚
â”‚  [Apply] [Cancel]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

â†’ Details: [Map.md](../entities/map.md#danger-zones-und-cr-budget)

---

## Dungeon-Tools

Bei `MapType: 'dungeon'` wechselt die Tool-Palette:

### Wall-Tool (Dungeon)

Zeichnet Waende auf dem 5ft-Grid.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§± WALLS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Wall Type                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆ  â”‚ â”‚ â–“â–“â–“  â”‚ â”‚ â–‘â–‘â–‘  â”‚        â”‚
â”‚  â”‚Stone â”‚ â”‚ Wood â”‚ â”‚ Bars â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ~~~  â”‚ â”‚ Â·Â·Â·  â”‚                  â”‚
â”‚  â”‚Force â”‚ â”‚Illusnâ”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                      â”‚
â”‚  Draw Mode                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Line] [â—‹ Rectangle] [â—‹ Free]    â”‚
â”‚                                      â”‚
â”‚  Properties                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  HP: [====â—=====] 50                â”‚
â”‚  AC: [===â—======] 15                â”‚
â”‚  â˜ Blocks Vision                     â”‚
â”‚  â˜‘ï¸ Blocks Movement                   â”‚
â”‚                                      â”‚
â”‚  [Erase Mode]                        â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Door-Tool (Dungeon)

Platziert Tueren zwischen Waenden.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸšª DOORS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Door Type                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ [=]  â”‚ â”‚ [â‰¡]  â”‚ â”‚ [#]  â”‚        â”‚
â”‚  â”‚Simpleâ”‚ â”‚Doubleâ”‚ â”‚Portclâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ [~]  â”‚ â”‚ [?]  â”‚                  â”‚
â”‚  â”‚Secretâ”‚ â”‚Trapdoorâ”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                      â”‚
â”‚  State                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Closed] [â—‹ Open] [â—‹ Locked]     â”‚
â”‚  [â—‹ Stuck] [â—‹ Barred]               â”‚
â”‚                                      â”‚
â”‚  Lock                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â˜ Locked                            â”‚
â”‚  DC: [===â—======] 15                â”‚
â”‚  Key: [________________] (optional)  â”‚
â”‚                                      â”‚
â”‚  Properties                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  HP: [===â—======] 18                â”‚
â”‚  AC: [===â—======] 15                â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Trap-Tool (Dungeon)

Platziert Fallen auf Tiles.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ TRAPS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Trap Type                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ â–¼    â”‚ â”‚ ~    â”‚ â”‚ âš¡   â”‚        â”‚
â”‚  â”‚ Pit  â”‚ â”‚Poisonâ”‚ â”‚ Magicâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ â´    â”‚ â”‚ ğŸ”¥   â”‚ â”‚ ğŸª¤   â”‚        â”‚
â”‚  â”‚Arrow â”‚ â”‚ Fire â”‚ â”‚Mechanâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                      â”‚
â”‚  Detection                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Perception DC: [====â—====] 15      â”‚
â”‚  Investigation DC: [===â—===] 13     â”‚
â”‚                                      â”‚
â”‚  Disarm                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  DC: [=====â—====] 14                â”‚
â”‚  Tool Req: [Thieves' Tools    â–¼]    â”‚
â”‚                                      â”‚
â”‚  Effect                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Damage: [2d10        ] piercing    â”‚
â”‚  Save: [DEX â–¼] DC [=====â—===] 14    â”‚
â”‚  Half on Save: â˜‘ï¸                    â”‚
â”‚                                      â”‚
â”‚  Trigger                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Pressure Plate] [â—‹ Tripwire]    â”‚
â”‚  [â—‹ Proximity] [â—‹ Manual]           â”‚
â”‚                                      â”‚
â”‚  Visibility                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Hidden] [â—‹ Visible] [â—‹ GM Only] â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Token-Placer (Dungeon)

Platziert Creature/Object Tokens.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ TOKEN PLACER                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Token Type                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [â— Creature] [â—‹ Object] [â—‹ Light]  â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Creature â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Search: [________________] ğŸ”       â”‚
â”‚                                      â”‚
â”‚  Recent:                             â”‚
â”‚  â€¢ Goblin                            â”‚
â”‚  â€¢ Skeleton                          â”‚
â”‚  â€¢ Giant Spider                      â”‚
â”‚                                      â”‚
â”‚  [Browse Library...]                 â”‚
â”‚                                      â”‚
â”‚  Size                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [T] [â—S] [M] [L] [H] [G]           â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Object â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸ“¦   â”‚ â”‚ ğŸª‘   â”‚ â”‚ ğŸ›ï¸   â”‚        â”‚
â”‚  â”‚Chest â”‚ â”‚Chair â”‚ â”‚ Bed  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸ“š   â”‚ â”‚ âš—ï¸   â”‚ â”‚ ğŸ—„ï¸   â”‚        â”‚
â”‚  â”‚Books â”‚ â”‚Potionsâ”‚ â”‚Shelf â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Light â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  Source: [Torch â–¼]                  â”‚
â”‚  Radius: [====â—=====] 40ft          â”‚
â”‚  Color: [ğŸŸ¡] [ğŸŸ ] [âšª] [ğŸ”µ]         â”‚
â”‚  â˜‘ï¸ Flicker Effect                   â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Faction-Praesenz-Berechnung

Die Praesenz von Fraktionen auf der Map wird vorberechnet und auf Tiles gespeichert.

### Berechnungslogik

Fraktionen kontrollieren Territorium ueber POIs. Die Gesamt-CR einer Fraktion wird auf alle Tiles im Territorium **verteilt** (Budget-System).

```typescript
function distributePresenceToTiles(
  faction: Faction,
  factionPOIs: POI[],
  allTiles: OverworldTile[],
  creatureRegistry: Map<EntityId<'creature'>, CreatureDefinition>
): void {
  if (factionPOIs.length === 0) return;

  // 1. CR-Summe berechnen: Î£(creature.cr Ã— count)
  const crTotal = faction.creatures.reduce((sum, group) => {
    const creature = creatureRegistry.get(group.creatureId);
    return sum + ((creature?.cr ?? 0) * group.count);
  }, 0);

  // 2. Maximale Reichweite: sqrt(CR) Ã— 2
  const maxRange = Math.sqrt(crTotal) * 2;

  // 3. Tiles im Territorium mit Gewichten sammeln
  const tilesWithWeights: Array<{ tile: OverworldTile; weight: number }> = [];

  for (const tile of allTiles) {
    const minDistance = Math.min(
      ...factionPOIs.map(poi => hexDistance(tile.coordinate, poi.position))
    );

    if (minDistance <= maxRange) {
      // Gewicht: Je naeher am POI, desto hoeher (1/(d+1))
      const weight = 1 / (minDistance + 1);
      tilesWithWeights.push({ tile, weight });
    }
  }

  // 4. Gewichte normalisieren (Summe = 1)
  const totalWeight = tilesWithWeights.reduce((sum, tw) => sum + tw.weight, 0);

  // 5. CR verteilen
  for (const { tile, weight } of tilesWithWeights) {
    const normalizedWeight = weight / totalWeight;
    tile.factionPresence = tile.factionPresence ?? [];
    tile.factionPresence.push({
      factionId: faction.id,
      strength: crTotal * normalizedWeight
    });
  }
}
```

### Workflow

1. GM platziert POIs und weist sie Fraktionen zu
2. Bei "Save" oder "Recalculate" wird Praesenz fuer alle Fraktionen berechnet
3. Ergebnis wird auf `OverworldTile.factionPresence[]` gespeichert

### Beispiel-Verteilung

| Tile | Distanz | Gewicht | Normalisiert | CR-Anteil |
|------|---------|---------|--------------|-----------|
| POI | 0 | 1.00 | 0.35 | 2.01 |
| A | 1 | 0.50 | 0.175 | 1.01 |
| B | 1 | 0.50 | 0.175 | 1.01 |
| C | 2 | 0.33 | 0.115 | 0.66 |
| **Summe** | | | **1.00** | **5.75** |

Summe aller CR-Anteile = Faction-Gesamt-CR (Budget-Constraint).

### Neuberechnung nach Attrition

Nach `faction:attrition-applied` werden betroffene Tiles neu berechnet:

```typescript
eventBus.on('faction:attrition-applied', (payload) => {
  const faction = entityRegistry.get('faction', payload.factionId);
  if (!faction) return;

  // Alte Praesenz entfernen
  for (const tile of getAllTiles()) {
    tile.factionPresence = tile.factionPresence?.filter(
      p => p.factionId !== faction.id
    );
  }

  // Neu berechnen
  const pois = getControlledPOIs(faction);
  distributePresenceToTiles(faction, pois, getAllTiles(), creatureRegistry);
});
```

â†’ Schema: [faction-presence.md](../entities/faction-presence.md)

---

## Layer-Control

Steuert sichtbare Layer im Canvas.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYERS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Overland â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  â˜‘ï¸ Terrain          [ğŸ‘ï¸] [ğŸ”’]       â”‚
â”‚  â˜‘ï¸ Elevation        [ğŸ‘ï¸] [  ]       â”‚
â”‚  â˜ Climate Overlay   [  ] [  ]       â”‚
â”‚  â˜ Faction Territory [  ] [  ]       â”‚
â”‚  â˜‘ï¸ Features         [ğŸ‘ï¸] [  ]       â”‚
â”‚  â˜‘ï¸ Locations        [ğŸ‘ï¸] [  ]       â”‚
â”‚  â˜ Hex Grid          [  ] [  ]       â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Dungeon â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                      â”‚
â”‚  â˜‘ï¸ Walls            [ğŸ‘ï¸] [ğŸ”’]       â”‚
â”‚  â˜‘ï¸ Doors            [ğŸ‘ï¸] [  ]       â”‚
â”‚  â˜ Traps (GM)        [  ] [  ]       â”‚
â”‚  â˜‘ï¸ Tokens           [ğŸ‘ï¸] [  ]       â”‚
â”‚  â˜‘ï¸ Light Sources    [ğŸ‘ï¸] [  ]       â”‚
â”‚  â˜ Grid              [  ] [  ]       â”‚
â”‚                                      â”‚
â”‚  Opacity                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Selected: [=========â—] 100%        â”‚
â”‚                                      â”‚
â”‚  [Show All] [Hide All]               â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Legende:**
- `[ğŸ‘ï¸]` = Sichtbar
- `[ğŸ”’]` = Gesperrt (nicht editierbar)

---

## Keyboard-Shortcuts

| Shortcut | Aktion |
|----------|--------|
| `1-6` | Tool auswaehlen |
| `[` / `]` | Brush-Groesse -/+ |
| `B` | Terrain-Brush |
| `E` | Elevation-Brush |
| `C` | Climate-Brush |
| `L` | Location-Marker |
| `I` | Inspector |
| `Ctrl+Z` | Undo |
| `Ctrl+Y` | Redo |
| `Ctrl+S` | Speichern |
| `Space` | Pan (hold) |
| `Scroll` | Zoom |

---

## State-Management

### ViewModel-State

```typescript
interface CartographerState {
  // Map
  activeMapId: EntityId<'map'> | null;
  mapType: MapType;  // 'overland' | 'dungeon'
  camera: CameraState;

  // Tools
  activeTool: ToolType;
  toolOptions: ToolOptions;

  // Layers
  visibleLayers: LayerId[];
  lockedLayers: LayerId[];
  layerOpacity: Record<LayerId, number>;

  // Selection
  selectedTiles: Coordinate[];
  hoveredTile: Coordinate | null;

  // Undo/Redo
  undoStack: EditAction[];
  redoStack: EditAction[];

  // UI
  sidebarCollapsed: boolean;
  inspectorOpen: boolean;
}
```

### Tool-Typen

```typescript
type OverlandTool =
  | 'terrain-brush'
  | 'elevation-brush'
  | 'climate-brush'
  | 'path-tool'        // Post-MVP: Lineare Features
  | 'location-marker'
  | 'inspector';

type DungeonTool =
  | 'wall-tool'
  | 'door-tool'
  | 'trap-tool'
  | 'token-placer'
  | 'inspector';

type ToolType = OverlandTool | DungeonTool;
```

---

## Prioritaet

| Komponente | MVP | Post-MVP | Notiz |
|------------|:---:|:--------:|-------|
| Terrain-Brush | âœ“ | | Kern-Tool |
| Elevation-Brush (Paint) | âœ“ | | Basis-Hoehen |
| Elevation-Brush (Gradient) | | mittel | Erweitert |
| Climate-Brush | | mittel | Override-System |
| **Danger-Zone-Brush** | âœ“ | | CR-Budget fuer Encounter-Generierung |
| Smooth-Transitions-Tool | | mittel | Terrain-Grenzen glÃ¤tten |
| Calculate-Derived-Tool | | mittel | Terrain-EinflÃ¼sse berechnen |
| **Path-Tool** | | âœ“ | Lineare Features |
| Location-Marker | âœ“ | | Entity-Verknuepfung |
| Inspector | âœ“ | | Tile-Details |
| Wall-Tool | âœ“ | | Dungeon-Kern |
| Door-Tool | âœ“ | | Dungeon-Kern |
| Trap-Tool | | mittel | Combat-Integration |
| Token-Placer | âœ“ | | Encounter-Setup |
| Layer-Control | âœ“ | | Basis-Visibility |
| Undo/Redo | âœ“ | | Editor-Essentials |

---

## Tasks

| # | Status | Domain | Layer | Beschreibung | Prio | MVP? | Deps | Spec | Imp. |
|--:|:------:|--------|-------|--------------|:----:|:----:|------|------|------|

---

