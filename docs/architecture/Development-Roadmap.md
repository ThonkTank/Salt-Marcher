# Development Roadmap

> **Wird ben√∂tigt von:** Aktueller Task

Implementierungsstrategie und aktueller Status f√ºr Salt Marcher.

---

## Status-Legende

| Status | Bedeutung |
|--------|-----------|
| ‚¨ú | Offen - Noch nicht implementiert |
| ‚úÖ | Implementiert und funktionsf√§hig |
| ‚ö†Ô∏è | Implementiert aber nicht funktionsf√§hig |
| üî∂ | Funktionsf√§hig aber nicht spezifikations-konform |

---

## üìã Tasks

|  # | Status | Domain    | Layer              | Beschreibung                                                                                           |  Prio   | MVP? | Deps     | Spec                                                                 | Imp.                                                                             |
|--:|:----:|:--------|:-----------------|:-----------------------------------------------------------------------------------------------------|:-----:|:--:|:-------|:-------------------------------------------------------------------|:-------------------------------------------------------------------------------|
|  1 |   ‚¨ú    | encounter | services           | Context-Filter: weather Tags, aquatic/terrain Tags f√ºr Activity-Auswahl                                | mittel  | Nein | -        | encounter/groupActivity.md#kontext-filter                            | groupActivity.ts.selectActivity()                                                |
|  2 |   ‚ö†Ô∏è   | encounter | services           | Goal-Ableitung mit Faction-Mappings                                                                    | mittel  | Nein | -        | encounter/groupActivity.md#Goal-Beispiele                            | groupActivity.ts.deriveGoal()                                                    |
|  3 |   ‚úÖ    | encounter | services           | Activity-Pool √ºber Culture-System aufl√∂sen (resolveCultureChain)                                       | mittel  | Nein | -        | encounter/groupActivity.md#Activity-Pool-Hierarchie                  | groupActivity.ts.selectActivity()                                                |
|  4 |   ‚úÖ    | groupSeed | services/encounter | TimeSegment type: 6-Segment-Type aus #types/timeSegment nutzen                                         | mittel  | Nein | -        | groupSeed.md#Gewichtung (Soft Factors)                               | -                                                                                |
|  5 |   ‚úÖ    | groupSeed | services/encounter | Weather-Pr√§ferenzen: context.weather + creature.preferences.weather                                    | mittel  | Nein | -        | groupSeed.md#Gewichtung (Soft Factors)                               | -                                                                                |
|  6 |   ‚úÖ    | groupSeed | services/encounter | CR-basierte Rarity: threatLevel { min, max } statt statischer creature.rarity                          | mittel  | Nein | -        | groupSeed.md#Gewichtung (Soft Factors)                               | -                                                                                |
|  7 |   ‚úÖ    | groupSeed | services/encounter | FactionStatus: Nur active Fraktionen liefern Kreaturen                                                 | mittel  | Nein | -        | groupSeed.md#Step 2.0: Fraktions/Nativ-Auswahl                       | -                                                                                |
|  8 |   ‚úÖ    | groupSeed | services/encounter | Roll-Range: crBudget statt max(crBudget, factionTotal+1)                                               | mittel  | Nein | -        | groupSeed.md#Step 2.0: Fraktions/Nativ-Auswahl                       | -                                                                                |
|  9 |   ‚úÖ    | encounter | services           | generateEncounterGroup: Funktionsname + Return-Typ (populate‚ÜígenerateEncounterGroup, null‚ÜíResult)      | mittel  | Nein | -        | groupPopulation.md#kern-funktion                                     | -                                                                                |
| 11 |   ‚¨ú    | Encounter | services           | Encounter.md: Result-Handling fuer groupSeed dokumentieren (Impl verwendet \/ null statt isErr/unwrap) | niedrig | Nein | -        | encounter.md#Orchestration: groupSeed -> groupPopulation             | -                                                                                |
| 12 |   ‚¨ú    | Encounter | services           | Encounter.md: exclude-Parameter als Teil von context dokumentieren (nicht separater options-Parameter) | niedrig | Nein | -        | encounter.md#Orchestration: groupSeed -> groupPopulation             | -                                                                                |
| 13 |   ‚¨ú    | Encounter | services           | Flavour-Service fuer Encounter-Beschreibung implementieren                                             | niedrig | Nein | -        | encounter.md#Pipeline                                                | -                                                                                |
| 16 |   ‚úÖ    | encounter | services           | Gruppen-Finalisierung: crypto.randomUUID(), templateRef-Tracking, status default                       | mittel  | Nein | -        | groupPopulation.md#Step 3.3: Gruppen-Finalisierung                   | -                                                                                |
| 17 |   ‚úÖ    | encounter | services           | Slot-Bef√ºllung: resolveCount mit randomNormal, Design-Rolle-Matching strikt                            | mittel  | Nein | -        | groupPopulation.md#Step 3.2: Slot-Befuellung                         | -                                                                                |
| 18 |   ‚úÖ    | encounter | services           | Generic Templates aus Vault laden und pr√ºfen                                                           | mittel  | Nein | -        | groupPopulation.md#Step 3.1: Template-Auswahl                        | -                                                                                |
| 19 |   ‚úÖ    | encounter | services           | Companion-Pool: Faction-Liste + Tag-Matching f√ºr fraktionslose Kreaturen                               | mittel  | Nein | -        | groupPopulation.md#Step 3.0: Companion-Pool Bildung                  | -                                                                                |
| 20 |   ‚úÖ    | encounter | services           | canFulfillTemplate: count-Summe statt Eintrags-Anzahl f√ºr Fraktionen                                   | mittel  | Nein | -        | groupPopulation.md#Step 3.1: Template-Auswahl                        | -                                                                                |
| 21 |   ‚úÖ    | encounter | services           | PopulatedGroup Output-Schema: groupId, templateRef, slots-Map, status                                  | mittel  | Nein | -        | groupPopulation.md#Output: PopulatedGroup                            | -                                                                                |
| 22 |   ‚úÖ    | encounter | services           | companionPool-Typen: {creatureId,count}[] f√ºr selectTemplate, canFulfillTemplate, fillSlot             | mittel  | Nein | -        | groupPopulation.md#Step 3.1: Template-Auswahl                        | -                                                                                |
| 23 |   ‚úÖ    | encounter | services           | active/resting Filter basierend auf creature.activeTime                                                | mittel  | Nein | -        | encounter/groupActivity.md#Kontext-Filter                            | groupActivity.ts.selectActivity()                                                |
| 24 |   ‚úÖ    | encounter | services           | Activity-Pool-Hierarchie (Step 4.1) implementiert                                                      | mittel  | Nein | -        | encounter/groupActivity.md#Activity-Definition                       | groupActivity.ts.selectActivity()                                                |
| 25 |   ‚úÖ    | encounter | services           | CultureData.activities auf string[] umgestellt                                                         | mittel  | Nein | -        | encounter/groupActivity.md#Activity-Definition                       | groupActivity.ts.selectActivity()                                                |
| 26 |   ‚¨ú    | Encounter | services           | Encounter.md: PartyMember.maxHp dokumentieren (existiert in partySnapshot.ts)                          | niedrig | Nein | -        | encounter.md#Input-Schema                                            | -                                                                                |
| 27 |   ‚¨ú    | Encounter | services           | EncounterConstraints implementieren (min/maxDifficulty, requiredTags) - Post-MVP                       | niedrig | Nein | -        | encounter.md#Input-Schema                                            | -                                                                                |
| 28 |   ‚¨ú    | NPCs      | services           | NPC-Matching: factionId undefined als fraktionsuebergreifend behandeln                                 | mittel  | Nein | -        | NPC-Matching.md#Faction-Matching                                     | -                                                                                |
| 29 |   ‚úÖ    | creature  | entities           | HP-Varianz: Trefferpunkte basierend auf Hit Dice wuerfeln statt maxHp direkt verwenden                 | mittel  | Nein | -        | creature.md#Felder                                                   | -                                                                                |
| 30 |   ‚úÖ    | Encounter | services           | terrain als vollstaendige TerrainDefinition (statt partieller Struktur)                                | mittel  |  Ja  | -        | encounter.md#Input-Schema                                            | -                                                                                |
| 31 |   ‚úÖ    | Encounter | services           | weather an groupSeed uebergeben (Weather-Praeferenzen aktiviert)                                       | mittel  |  Ja  | -        | encounter.md#Pipeline                                                | -                                                                                |
| 32 |   ‚úÖ    | Encounter | services           | crBudget in Doku ergaenzt, position+thresholds in PartySnapshot                                        | mittel  |  Ja  | -        | encounter.md#Input-Schema                                            | -                                                                                |
| 33 |   ‚úÖ    | Encounter | services           | trigger bleibt string (MVP), Doku mit Post-MVP-Hinweis                                                 | mittel  |  Ja  | -        | encounter.md#Input-Schema                                            | -                                                                                |
| 34 |   ‚úÖ    | Encounter | services           | position verwendet HexCoordinate statt inline { q, r }                                                 | mittel  |  Ja  | -        | encounter.md#Input-Schema                                            | -                                                                                |
| 35 |   ‚úÖ    | Encounter | services           | NPCs auf Encounter-Ebene (1-3 NPCs), nicht mehr leadNPC pro Gruppe                                     | mittel  |  Ja  | -        | encounter.md#Pipeline                                                | -                                                                                |
| 36 |   ‚¨ú    | NPCs      | services           | findExistingNPC: Basis-Matching (creature.id + factionId + status)                                     | mittel  | Nein | -        | NPC-Matching.md#Match-Kriterien                                      | -                                                                                |
| 37 |   ‚¨ú    | NPCs      | services           | NPC-Priorisierung: Distanz (primaer) + lastEncounter (sekundaer)                                       | mittel  | Nein | -        | NPC-Matching.md#Priorisierung                                        | -                                                                                |
| 38 |   ‚¨ú    | Encounter | services           | calculateHP: Basis-Implementation (maxHp direkt)                                                       | mittel  | Nein | -        | encounter.md#NPC-Zuordnung                                           | -                                                                                |
| 39 |   ‚¨ú    | Encounter | services           | convertGroupWithNPCs: Output-Konversion mit HP-Expansion                                               | mittel  | Nein | -        | encounter.md#NPC-Zuordnung                                           | -                                                                                |
| 40 |   ‚¨ú    | Encounter | services           | rollNPCCount: Single-Group 1-3 NPCs (50/35/15%)                                                        | mittel  | Nein | -        | encounter.md#encounterNPCs (Step 4.3)                                | -                                                                                |
| 41 |   ‚¨ú    | Encounter | services           | rollExtraNPCs: Multi-Group Extra-NPCs (0-1)                                                            | mittel  | Nein | -        | encounter.md#encounterNPCs (Step 4.3)                                | -                                                                                |
| 42 |   ‚¨ú    | Encounter | services           | collectAllCandidates: Kreaturen sammeln mit Gewichtung                                                 | mittel  | Nein | -        | encounter.md#encounterNPCs (Step 4.3)                                | -                                                                                |
| 43 |   ‚¨ú    | Encounter | services           | weightedSelectOne: Gewichtete Einzelauswahl                                                            | mittel  | Nein | -        | encounter.md#encounterNPCs (Step 4.3)                                | -                                                                                |
| 44 |   ‚¨ú    | Encounter | services           | weightedSampleWithoutReplacement: Auswahl ohne Zuruecklegen                                            | mittel  | Nein | -        | encounter.md#encounterNPCs (Step 4.3)                                | -                                                                                |
| 45 |   ‚¨ú    | Encounter | services           | selectWithGroupConstraint: Multi-Group min 1 NPC pro Gruppe                                            | mittel  | Nein | -        | encounter.md#encounterNPCs (Step 4.3)                                | -                                                                                |
| 46 |   ‚¨ú    | Encounter | services           | matchOrGenerateNPC: Match-oder-Generate Orchestrierung                                                 | mittel  | Nein | -        | encounter.md#encounterNPCs (Step 4.3)                                | -                                                                                |
| 47 |   ‚¨ú    | Encounter | services           | assignEncounterNPCs: Haupt-Funktion (Pipeline-Orchestrierung)                                          | mittel  | Nein | -        | encounter.md#encounterNPCs (Step 4.3)                                | -                                                                                |
| 48 |   ‚¨ú    | NPCs      | services           | generateNPC: Delegation an npcGenerator-Service                                                        | mittel  | Nein | -        | NPC-Generation.md#API                                                | -                                                                                |
| 49 |   ‚¨ú    | Encounter | services           | ROLE_WEIGHTS Konstante (CR √ó Rolle Gewichtung)                                                         | mittel  | Nein | -        | encounter.md#ROLE_WEIGHTS (Multiplikatoren)                          | -                                                                                |
| 50 |   ‚¨ú    | Encounter | services           | AssignNPCsResult: Output-Typ (matchedNPCs, generatedNPCs, groups)                                      | mittel  | Nein | -        | encounter.md#NPC-Zuordnung                                           | -                                                                                |
| 51 |   ‚¨ú    | Encounter | services           | EncounterCreatureInstance: Output-Typ (definitionId, HP, npcId)                                        | mittel  | Nein | -        | encounter.md#NPC-Zuordnung                                           | -                                                                                |
| 52 |   ‚¨ú    | Encounter | services           | GroupWithNPCs: Output-Typ (erweitert GroupWithActivity)                                                | mittel  | Nein | -        | encounter.md#NPC-Zuordnung                                           | -                                                                                |
| 54 |   ‚úÖ    | NPCs      | services           | Culture-Resolution: Faction-Ketten-Traversierung via parentId                                          | mittel  | Nein | -        | Culture-Resolution.md#buildFactionChain()                            | npcGenerator.ts.resolveCultureChain() [√§ndern]                                   |
| 55 |   ‚úÖ    | NPCs      | services           | Quirk-Filterung: compatibleTags aus Creature pruefen                                                   | mittel  | Nein | -        | NPC-Generation.md#Quirk-Generierung                                  | npcGenerator.ts.rollQuirkFromCulture() [√§ndern]                                  |
| 56 |   ‚úÖ    | NPCs      | services           | PersonalityBonus: Multiplikatoren auf Goals anwenden                                                   | mittel  | Nein | -        | NPC-Generation.md#PersonalGoal-Pool-Hierarchie                       | npcGenerator.ts.selectPersonalGoal() [√§ndern]                                    |
| 57 |   ‚úÖ    | NPCs      | services           | getDefaultTime: Zeit aus sessionState statt Hardcoded-Wert                                             | mittel  | Nein | -        | NPC-Generation.md#API                                                | npcGenerator.ts.getDefaultTime() [√§ndern]                                        |
| 58 |   ‚úÖ    | NPCs      | services           | Species-Cultures in Culture-Resolution implementiert                                                   | mittel  | Nein | -        | Culture-Resolution.md#Kultur-Hierarchie                              | npcGenerator.ts.resolveCultureChain() [fertig]                                   |
| 59 |   ‚úÖ    | types     | entities           | ReputationEntry Zod-Schema in src/types/common/reputation.ts erstellen                                 | mittel  | Nein | -        | types.md#ReputationEntry                                             | reputation.ts [neu]                                                              |
| 60 |   ‚úÖ    | encounter | services           | Disposition-Berechnung mit baseDisposition + Reputation implementieren                                 | mittel  | Nein | #59      | services/encounter/groupActivity.md#Step-4.3:-Disposition-Berechnung | groupActivity.ts.assignActivity() [√§ndern]                                       |
| 61 |   ‚úÖ    | creature  | constants          | DISPOSITION_THRESHOLDS und BASE_DISPOSITION_VALUES Konstanten hinzufuegen                              | mittel  | Nein | -        | services/encounter/groupActivity.md#Disposition-Berechnung           | constants/creature.ts [√§ndern]                                                   |
| 62 |   ‚úÖ    | creature  | entities           | CreatureDefinition: disposition zu baseDisposition (number) migrieren                                  | mittel  | Nein | #61      | entities/creature.md#Felder                                          | types/entities/creature.ts [√§ndern]                                              |
| 63 |   ‚úÖ    | NPCs      | entities           | NPC-Schema: reputations Array hinzufuegen                                                              | mittel  | Nein | #59      | entities/npc.md#reputations                                          | types/entities/npc.ts [√§ndern]                                                   |
| 64 |   ‚úÖ    | faction   | entities           | Faction-Schema: reputationWithParty zu reputations Array migrieren                                     | mittel  | Nein | #59      | entities/faction.md#reputations                                      | types/entities/faction.ts [√§ndern]                                               |
| 65 |   ‚¨ú    | creature  | entities           | Creature-Presets: disposition zu baseDisposition konvertieren                                          | mittel  | Nein | #62      | entities/creature.md#baseDisposition                                 | presets/creatures.ts [neu]                                                       |
| 66 |   ‚¨ú    | faction   | entities           | Faction-Presets: reputationWithParty zu reputations Array konvertieren                                 | mittel  | Nein | #64      | entities/faction.md#reputations                                      | presets/factions.ts [neu]                                                        |
| 67 |   ‚úÖ    | NPCs      | services           | Culture-Resolution: Soft-Weighting fuer Traits implementiert                                           | mittel  | Nein | -        | Culture-Resolution.md#Trait-System                                   | npcGenerator.ts.rollPersonalityFromCulture() [fertig]                            |
| 68 |   ‚úÖ    | Loot      | types              | LootBudgetState Interface definieren (accumulated, distributed, balance, debt)                         | mittel  | Nein | -        | Loot.md#lootbudgetstate                                              | types/loot.ts [neu]                                                              |
| 69 |   ‚úÖ    | Loot      | constants          | GOLD_PER_XP_BY_LEVEL Konstante (DMG-Tabelle Level 1-20)                                                | mittel  | Nein | -        | Loot.md#budget-berechnung                                            | constants/loot.ts [neu]                                                          |
| 70 |   ‚úÖ    | Loot      | services           | getGoldPerXP() - Lookup in DMG-Tabelle, clamp 1-20                                                     | mittel  | Nein | #69      | Loot.md#budget-berechnung                                            | services/lootGenerator/lootGenerator.ts.getGoldPerXP() [neu]                     |
| 72 |   ‚úÖ    | Loot      | constants          | WEALTH_MULTIPLIERS Konstante (destitute bis hoard)                                                     | mittel  | Nein | -        | Loot.md#wealth-multipliers                                           | constants/loot.ts [neu]                                                          |
| 73 |   ‚úÖ    | Loot      | services           | getWealthMultiplier() - Wealth-Tag aus Creature lesen, default 1.0                                     | mittel  | Nein | #72      | Loot.md#wealth-system                                                | services/lootGenerator/lootGenerator.ts.getWealthMultiplier() [neu]              |
| 74 |   ‚úÖ    | Loot      | services           | calculateAverageWealthMultiplier() - Durchschnitt ueber alle Kreaturen                                 | mittel  | Nein | #73      | Loot.md#wealth-system                                                | services/lootGenerator/lootGenerator.ts.calculateAverageWealthMultiplier() [neu] |
| 75 |   ‚úÖ    | Loot      | services           | calculateLootValue() - totalXP * LOOT_MULTIPLIER * avgWealth                                           | mittel  | Nein | #74      | Loot.md#loot-wert-berechnung                                         | services/lootGenerator/lootGenerator.ts.calculateLootValue() [neu]               |
| 78 |   ‚úÖ    | Loot      | services           | selectWeightedItem() - Gewichtete Zufallsauswahl aus Pool                                              | mittel  | Nein | -        | Loot.md#item-auswahl                                                 | services/lootGenerator/lootGenerator.ts.selectWeightedItem() [neu]               |
| 79 |   ‚úÖ    | Loot      | services           | generateLoot(pool, budget) - Pool-basiertes Loot bis Budget erschoepft                                 | mittel  | Nein | #75, #78 | Loot.md#item-auswahl                                                 | services/lootGenerator/lootGenerator.ts.generateLoot() [neu]                     |
| 80 |   ‚¨ú    | Loot      | types              | GeneratedLoot Interface (items: SelectedItem[], totalValue: number)                                    | mittel  | Nein | #81      | Loot.md#generatedloot                                                | types/loot.ts [neu]                                                              |
| 81 |   ‚úÖ    | Loot      | types              | SelectedItem Interface (item: Item, quantity: number)                                                  | mittel  | Nein | -        | Loot.md#selecteditem                                                 | types/loot.ts [neu]                                                              |
| 82 |   ‚úÖ    | Loot      | services           | ScoredItem Interface intern (item: Item, score: number)                                                | mittel  | Nein | -        | Loot.md#scoreditem                                                   | services/lootGenerator/lootGenerator.ts [neu]                                    |
| 83 |   ‚úÖ    | Encounter | services           | aggregatePools() - Creature-Pools kombinieren mit CR-Gewichtung                                        | mittel  | Nein | -        | encounterLoot.md#step-1-pools-aggregieren--budget-berechnen          | encounterGenerator/encounterLoot.ts [√§ndern]                                     |
| 84 |   ‚úÖ    | Encounter | services           | distributeItems() - Items auf Creatures verteilen (CR √ó Pool-Match)                                    | mittel  | Nein | -        | encounterLoot.md#step-3-items-auf-kreaturen-verteilen                | encounterGenerator/encounterLoot.ts [√§ndern]                                     |

---

## üêõ Bugs

| b# | Status | Beschreibung                                                                          | Prio | Deps |
|--:|:----:|:------------------------------------------------------------------------------------|:--:|:---|
| b1 |   ‚¨ú    | disposition Feld in groupActivity nicht dokumentiert (Code: hostile/neutral/friendly) | hoch | #2   |

---

## Verwandte Dokumentation

| Thema | Dokument |
|-------|----------|
| Data Layer | Data.md |
| Events | Events-Catalog.md |
| Layer-Struktur | Project-Structure.md |
| Error-Handling | Error-Handling.md |
| Conventions | Conventions.md |
| Testing | Testing.md |
