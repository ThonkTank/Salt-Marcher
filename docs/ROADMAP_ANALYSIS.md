# Roadmap-Bestandsaufnahme & Priorisierung
**Erstellt:** 2025-10-28
**Status:** Phase 2.7 ‚úÖ Abgeschlossen

## üìä Aktueller Stand

### Completed Phases ‚úÖ

| Phase | Status | Completion | Key Deliverables |
|-------|--------|------------|------------------|
| **Phase 0** | ‚úÖ Complete | 100% | Tags, Schemas, Samples, Validators |
| **Phase 2.1** | ‚úÖ Complete | 100% | Faction Territory Marking (Cartographer Brush + Inspector) |
| **Phase 2.2** | ‚úÖ Complete | ~90% | Faction Context in Sessions (Event Flow) |
| **Phase 2.4** | ‚úÖ Complete | 100% | Encounter Composition MVP (Creature Selection + XP Calc) |
| **Phase 2.7** | ‚úÖ Complete | 100% | **HP & Initiative Tracking** (Combat spielbar!) |

### In-Progress Phases ‚öôÔ∏è

| Phase | Status | Completion | Blocker/Next Steps |
|-------|--------|------------|-------------------|
| **Phase 1** | ‚öôÔ∏è In Progress | 75% | 14 Test failures (brauchen Obsidian-API-Mocks), Library-Repos migrieren |

### Planned Phases ‚è≥

| Phase | Priority | Dependencies | User Value |
|-------|----------|--------------|------------|
| **Phase 2.6** | üî¥ Kritisch | Phase 2.7 ‚úÖ | Random Encounter Generation - Automatisiert Encounter-Komposition |
| **Phase 2.5** | üü¢ Nice-to-have | Phase 2.4 ‚úÖ | Faction-based Creature Filtering - QoL f√ºr manuelle Komposition |
| **Phase 2.3** | ‚ö° Future | Phase 3 | Member Management (Subfraktionen, NPCs, Jobs) |
| **Phase 3** | üü° Important | Phase 2 Complete | Orte & Dungeons (Neuer Vertical Slice!) |
| **Phase 4** | ‚è≥ Later | Phase 3 | Event Engine & Automation |
| **Phase 5** | ‚è≥ Later | Phase 4 | Calculator & Loot Services |
| **Phase 6** | ‚è≥ Release | Phase 5 | Audio & Experience Layer |

## üéØ Vertical Slice Analysis

### Encounter Vertical Slice (Phase 2)

**Ziel:** GM kann Encounters von Start bis Ende durchspielen.

**Status:** üü° Basis-Slice KOMPLETT, Automatisierung ausstehend

**Completed Steps:**
1. ‚úÖ **Phase 2.1:** Fraktionen auf Karte zuweisen
2. ‚úÖ **Phase 2.2:** Faction-Kontext zu Encounters
3. ‚úÖ **Phase 2.4:** Creature Composition (manuell)
4. ‚úÖ **Phase 2.7:** HP & Initiative Tracking

**Workflow funktioniert END-TO-END:**
```
Travel ‚Üí Encounter Event (mit Faction) ‚Üí Creatures hinzuf√ºgen ‚Üí XP berechnen
‚Üí Start Combat ‚Üí Initiative eingeben ‚Üí HP tracken ‚Üí Defeated markieren ‚Üí Resolve
```

**Remaining f√ºr vollst√§ndigen Vertical Slice:**
- üî¥ **Phase 2.6:** Random Encounter Generation (Automatisierung)
- üü¢ **Phase 2.5:** Faction Filtering (QoL, optional)

### Orte & Dungeons Vertical Slice (Phase 3)

**Ziel:** GM kann Orte hierarchisch verwalten und Dungeons mit Grid-Karte spielen.

**Status:** ‚è≥ Noch nicht gestartet

**Dependencies:**
- KEINE technischen Dependencies zu Phase 2
- Kann theoretisch parallel entwickelt werden
- ABER: Vertical Slice Principle sagt "finish one slice before starting another"

## üîç Critical Path Analysis

### Option A: Complete Encounter Slice FIRST (Empfohlen nach Vertical Slice Principle)

```
1. Phase 1 finalisieren (Test-Suite + Library-Repos)     [~3-4 Tage]
   ‚îú‚îÄ 14 Test failures beheben (Obsidian-API-Mocks)
   ‚îú‚îÄ Library-Repos auf Store-Pattern migrieren
   ‚îî‚îÄ Seed-System f√ºr reproduzierbare Tests

2. Phase 2.6 - Random Encounter Generation               [~4-5 Tage]
   ‚îú‚îÄ Generator-Logic (Faction/Terrain/Region ‚Üí Creatures)
   ‚îú‚îÄ CR Budget Calculation (Party Level ‚Üí Difficulty)
   ‚îú‚îÄ Tag-based Creature Selection
   ‚îî‚îÄ Integration in Session Runner

3. [OPTIONAL] Phase 2.5 - Faction Filtering              [~1-2 Tage]
   ‚îú‚îÄ Faction-Filter-Dropdown in Creature List
   ‚îî‚îÄ Relevance-Scoring (Exact > Partial > No match)

4. Phase 3 - Orte & Dungeons                             [~10-14 Tage]
   ‚îî‚îÄ Neuer Vertical Slice
```

**Vorteile:**
- ‚úÖ Encounter-System vollst√§ndig fertig
- ‚úÖ Entspricht Vertical Slice Principle
- ‚úÖ Jeder Step liefert User-Value
- ‚úÖ Foundation (Phase 1) ist stabil

**Nachteile:**
- ‚ùå Phase 3 wartet l√§nger

### Option B: Start Phase 3 immediately

```
1. Phase 3 - Orte & Dungeons                             [~10-14 Tage]
   ‚îî‚îÄ Neuer Feature-Bereich

2. Sp√§ter: Phase 2.6 + 2.5
```

**Vorteile:**
- ‚úÖ Schneller neue Features (Orte & Dungeons)
- ‚úÖ Parallele Entwicklung m√∂glich

**Nachteile:**
- ‚ùå Encounter Vertical Slice bleibt unvollst√§ndig
- ‚ùå Phase 1 Foundation-Tasks bleiben offen
- ‚ùå Widerspricht Vertical Slice Principle
- ‚ùå Random Encounters fehlen (User muss alles manuell machen)

## üéØ Empfohlene Priorisierung

### **KRITISCH üî¥ - N√§chste 2 Wochen**

#### 1. Phase 1 - Foundation abschlie√üen [~3-4 Tage]

**Rationale:** Foundation muss stabil sein. 14 Test failures blockieren produktiven Workflow.

**Tasks:**
- [ ] **Test-Suite reparieren** (14 failures ‚Üí 0)
  - Obsidian-API-Mocks implementieren (`app.vault`, `registerEvent`, `SVG`)
  - Vitest Mock-Layer erstellen
  - Integration-Tests auf neue Mocks umstellen
- [ ] **Library-Repos migrieren**
  - `creature-repository.ts`, `spell-repository.ts`, `item-repository.ts`, `equipment-repository.ts`
  - Auf PersistentStore-Pattern umstellen
  - Konsistent mit `terrain-repository.ts` und `region-repository.ts`
- [ ] **Seed-System implementieren**
  - `devkit seed --preset default` f√ºr reproduzierbare Tests
  - Seed-Vaults in `devkit/testing/seeds/`
  - CLI-Integration

**DoD:**
- [ ] Alle Tests gr√ºn (0 failures)
- [ ] Library-Repos nutzen PersistentStores
- [ ] Seed-System funktioniert (`devkit seed --preset default`)

#### 2. Phase 2.6 - Random Encounter Generation [~4-5 Tage]

**Rationale:** Komplettiert Encounter Vertical Slice. Automatisiert was in Phase 2.7 spielbar gemacht wurde.

**Tasks:**
- [ ] **Generator-Logic** (`src/workmodes/encounter/generator.ts`)
  - Input: Faction, Terrain, Region, Party Level
  - Output: `EncounterCreature[]` mit Count basierend auf CR Budget
- [ ] **Tag-based Creature Selection**
  - Creature-Library filtern nach Faction/Terrain-Tags
  - Scoring: Exact match > Partial match > No match
  - Fallback: Generische Creatures wenn keine passenden gefunden
- [ ] **CR Budget Calculation**
  - Party Level ‚Üí Target XP (Easy/Medium/Hard/Deadly)
  - CR-Kombinationen finden die Target XP treffen
  - Varianz f√ºr √úberraschung (¬±20%)
- [ ] **Session Runner Integration**
  - "Generate Random Encounter" Button
  - Generator nutzt Faction vom aktuellen Hex
  - Generierte Creatures landen direkt in Composition

**DoD:**
- [ ] User kann "Generate Random Encounter" klicken
- [ ] Generator ber√ºcksichtigt Faction/Terrain/Region
- [ ] Generierte Encounters sind balanciert (CR Budget stimmt)
- [ ] Build erfolgreich, Tests gr√ºn

### **OPTIONAL üü¢ - Wenn Zeit bleibt**

#### 3. Phase 2.5 - Faction-based Creature Filtering [~1-2 Tage]

**Rationale:** QoL f√ºr manuelle Encounter-Komposition. Nicht kritisch da Random Generator bereits filtert.

**Tasks:**
- [ ] Faction-Filter-Dropdown in Creature List
- [ ] Relevance-Indicator neben Creatures
- [ ] Filter-Logic: `filterCreaturesByFaction(creatures, factionTags)`

**DoD:**
- [ ] User kann Creature-Liste nach Faction filtern
- [ ] Relevance-Scoring funktioniert (Exact > Partial > No match)

### **SP√ÑTER ‚è≥ - Nach Phase 2 Completion**

#### 4. Phase 3 - Orte & Dungeons [~10-14 Tage]

**Rationale:** Neuer Vertical Slice. Erst starten wenn Phase 2 vollst√§ndig ist.

**Kickoff-Checkliste:**
- [ ] Phase 2 DoD komplett erf√ºllt (inkl. 2.6)
- [ ] E2E-Test l√§uft gr√ºn (Travel ‚Üí Encounter ‚Üí Combat)
- [ ] Dokumentation aktualisiert
- [ ] Schema & Samples f√ºr `Orte/` finalisiert

## üìã N√§chste Schritte (Konkret)

### Diese Woche (KW 46)

**Montag-Dienstag:**
- [ ] Test-Suite reparieren (Obsidian-API-Mocks)
- [ ] Erste Library-Repo migrieren (creature-repository.ts)

**Mittwoch-Donnerstag:**
- [ ] Restliche Library-Repos migrieren
- [ ] Seed-System implementieren

**Freitag:**
- [ ] Phase 2.6 Design-Doc schreiben
- [ ] Generator-Logic Prototype

### N√§chste Woche (KW 47)

**Montag-Mittwoch:**
- [ ] Phase 2.6 Implementation (Generator + Integration)

**Donnerstag-Freitag:**
- [ ] Tests & Smoke Tests
- [ ] Dokumentation
- [ ] [OPTIONAL] Phase 2.5 starten

## ‚úÖ Alignment mit Zielen & Arbeitsweisen

### ‚úÖ Vertical Slice Principle
- Encounter Slice wird VOLLST√ÑNDIG fertiggestellt (2.1 ‚Üí 2.2 ‚Üí 2.4 ‚Üí 2.7 ‚Üí 2.6)
- Erst dann neuer Slice (Phase 3)

### ‚úÖ Simple > Clever
- Foundation erst stable machen (Test-Suite)
- Dann Features auf stabiler Basis

### ‚úÖ DRY
- Library-Repos Migrations nutzt bestehendes Store-Pattern
- Random Generator nutzt bestehende Tag-Filter-Logic

### ‚úÖ User-Value First
- Jeder Step liefert direkten Value
- Phase 2.6 automatisiert was User jetzt manuell machen muss

### ‚úÖ Testing Philosophy
- Test-Suite MUSS gr√ºn sein bevor wir weitermachen
- Seed-System erm√∂glicht reproduzierbare Tests

## üéØ Fazit & Empfehlung

**EMPFEHLUNG: Option A - Complete Encounter Slice FIRST**

**Begr√ºndung:**
1. **Foundation first:** Test-Suite muss gr√ºn sein (14 failures blockieren)
2. **Vertical Slice Principle:** Encounter Slice KOMPLETT fertigstellen
3. **User Value:** Random Generation automatisiert was jetzt manuell ist
4. **Code Quality:** Stable Foundation f√ºr Phase 3

**Timeline:**
- Phase 1: ~3-4 Tage
- Phase 2.6: ~4-5 Tage
- **Total: ~1.5-2 Wochen bis Encounter Slice complete**
- Dann: Phase 3 mit stabilem Foundation

**Alternative:**
Falls du UNBEDINGT Phase 3 sofort willst, k√∂nnen wir das machen. ABER:
- Test-Suite bleibt broken (14 failures)
- Encounter Slice bleibt incomplete (kein Random Generation)
- Widerspricht Vertical Slice Principle

**Was m√∂chtest du?**
