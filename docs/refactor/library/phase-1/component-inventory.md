# Component Inventory – Library Feature

| Component | Path | Purpose | Public API | Key Dependencies |
| --- | --- | --- | --- | --- |
| LibraryView | `src/apps/library/view.ts` | Obsidian `ItemView` shell that initialises data sources, renders search/header UI and activates mode renderers. | `LIBRARY_COPY`, `VIEW_LIBRARY`, `LibraryView`, `openLibrary()` | Mode renderers, `ensureLibrarySources`, `describeLibrarySource`. 【F:src/apps/library/view.ts†L1-L169】 |
| Mode Framework | `src/apps/library/view/mode.ts` | Defines `Mode` union, scoring helper and lifecycle contract plus `BaseModeRenderer` cleanup helpers. | `Mode`, `ModeRenderer`, `scoreName()`, `BaseModeRenderer` | Obsidian `App`, library source ids. 【F:src/apps/library/view/mode.ts†L1-L53】 |
| CreaturesRenderer | `src/apps/library/view/creatures.ts` | Lists creature files with filter/sort UI, opens editors and handles creation. | `CreaturesRenderer` | `BaseModeRenderer`, creature file pipeline, presets, creature modal. 【F:src/apps/library/view/creatures.ts†L1-L249】 |
| SpellsRenderer | `src/apps/library/view/spells.ts` | Lists spell files and delegates creation to spell modal. | `SpellsRenderer` | `BaseModeRenderer`, spell file pipeline, spell modal. 【F:src/apps/library/view/spells.ts†L1-L46】 |
| ItemsRenderer | `src/apps/library/view/items.ts` | Lists magic item files, imports existing files into modal editor, writes back updates. | `ItemsRenderer` | `BaseModeRenderer`, item file pipeline, item modal, dynamic `itemToMarkdown` import. 【F:src/apps/library/view/items.ts†L1-L121】 |
| EquipmentRenderer | `src/apps/library/view/equipment.ts` | Lists equipment files with import/edit flow. | `EquipmentRenderer` | `BaseModeRenderer`, equipment pipeline, equipment modal, dynamic `equipmentToMarkdown` import. 【F:src/apps/library/view/equipment.ts†L1-L118】 |
| TerrainsRenderer | `src/apps/library/view/terrains.ts` | Manages terrain list with debounced persistence, ensures placeholder entry and watcher refresh. | `TerrainsRenderer` | `BaseModeRenderer`, terrain store (`ensure/load/save/watch`). 【F:src/apps/library/view/terrains.ts†L1-L162】 |
| RegionsRenderer | `src/apps/library/view/regions.ts` | Manages regions tied to terrains with debounce saving and cross-store watchers. | `RegionsRenderer` | `BaseModeRenderer`, `enhanceSelectToSearch`, region/terrain stores. 【F:src/apps/library/view/regions.ts†L1-L168】 |
| Sources Service | `src/apps/library/core/sources.ts` | Central registry for library sources with ensure/describe helpers. | `LibrarySourceId`, `LIBRARY_SOURCE_IDS`, `ensureLibrarySource(s)`, `describeLibrarySource()` | Category pipelines, terrain/region stores. 【F:src/apps/library/core/sources.ts†L1-L52】 |
| Vault Pipeline | `src/apps/library/core/file-pipeline.ts` | Generic helper to ensure directories, list, watch and create vault files. | `sanitizeVaultFileName()`, `createVaultFilePipeline()` returning `{ensure,list,watch,create}` | Obsidian vault API. 【F:src/apps/library/core/file-pipeline.ts†L1-L88】 |
| Creature Files | `src/apps/library/core/creature-files.ts` | Defines statblock schema, helpers and Markdown serializer using generic pipeline. | `StatblockData` types, `ensureCreatureDir`, `listCreatureFiles`, `watchCreatureDir`, `createCreatureFile`, `statblockToMarkdown()` etc. | `createVaultFilePipeline`, statblock helpers. 【F:src/apps/library/core/creature-files.ts†L1-L146】 |
| Creature Presets | `src/apps/library/core/creature-presets.ts` | Loads preset statblocks from vault, migrates legacy spellcasting data. | `PRESETS_DIR`, `ensurePresetDir`, `listPresetFiles`, `watchPresetDir`, `loadCreaturePreset()` | Preset pipeline, `spellcastingDataToEntry`. 【F:src/apps/library/core/creature-presets.ts†L1-L118】 |
| Spell Files | `src/apps/library/core/spell-files.ts` | Spell data schema, Markdown serialiser and pipeline wrappers. | `SpellData`, `ensureSpellDir`, `listSpellFiles`, `watchSpellDir`, `createSpellFile`, `spellToMarkdown()` | `createVaultFilePipeline`. 【F:src/apps/library/core/spell-files.ts†L1-L43】 |
| Item Files | `src/apps/library/core/item-files.ts` | Detailed magic item schema with JSON fields and Markdown serialiser/pipeline. | `ItemData`, `ensureItemDir`, `listItemFiles`, `watchItemDir`, `itemToMarkdown()` | `createVaultFilePipeline`. 【F:src/apps/library/core/item-files.ts†L1-L77】 |
| Equipment Files | `src/apps/library/core/equipment-files.ts` | Equipment schema & serializer with pipeline wrappers. | `EquipmentData`, `ensureEquipmentDir`, `listEquipmentFiles`, `watchEquipmentDir`, `equipmentToMarkdown()` | `createVaultFilePipeline`. 【F:src/apps/library/core/equipment-files.ts†L1-L80】 |
| Terrain Store | `src/core/terrain-store.ts` | Ensures terrain Markdown file, parses/serializes code block, debounced watcher. | `TERRAIN_FILE`, `ensureTerrainFile`, `parseTerrainBlock`, `stringifyTerrainBlock`, `loadTerrains`, `saveTerrains`, `watchTerrains()` | Obsidian vault + global terrain state. 【F:src/core/terrain-store.ts†L1-L94】 |
| Regions Store | `src/core/regions-store.ts` | Ensures regions file, parses/serializes list, debounced watcher with auto-restore. | `REGIONS_FILE`, `Region`, `ensureRegionsFile`, `parseRegionsBlock`, `stringifyRegionsBlock`, `loadRegions`, `saveRegions`, `watchRegions()` | Obsidian vault, Notice API. 【F:src/core/regions-store.ts†L1-L89】 |
| CreateCreatureModal | `src/apps/library/create/creature/modal.ts` | Multi-section creature editor coordinating navigation, validation and preset migration. | `CreateCreatureModal` | Creature sections, `spellcastingDataToEntry`, `listSpellFiles`. 【F:src/apps/library/create/creature/modal.ts†L1-L126】 |
| CreateSpellModal | `src/apps/library/create/spell/modal.ts` | Spell editor with scaling validation and token chips. | `CreateSpellModal` | `enhanceSelectToSearch`, `collectSpellScalingIssues`, token editor. 【F:src/apps/library/create/spell/modal.ts†L1-L98】 |
| CreateItemModal | `src/apps/library/create/item/modal.ts` | Magic item editor covering attunement, charges, JSON-backed properties and validation. | `CreateItemModal` | `enhanceSelectToSearch`, `collectItemValidationIssues`. 【F:src/apps/library/create/item/modal.ts†L1-L96】 |
| CreateEquipmentModal | `src/apps/library/create/equipment/modal.ts` | Equipment editor tailored per type with conditional sections. | `CreateEquipmentModal` | `enhanceSelectToSearch`, equipment schema. 【F:src/apps/library/create/equipment/modal.ts†L1-L82】 |

## Layering Notes
- UI renderers depend on core pipelines and shared Obsidian APIs, while pipelines stay UI-agnostic. The generated dependency graph confirms there are no internal cycles and highlights `view.ts` as the sole orchestrator bridging UI and persistence layers. 【F:docs/refactor/library/phase-1/dependency-graph.dot†L1-L66】【e52123†L1-L33】
