# Creature Creation Overview

## Strukturübersicht
```
creature/
├─ index.ts              – Exportiert die öffentlichen Mount-/Modal-Hooks.
├─ modal.ts              – Orchestriert den Dialog und bündelt die Sections.
├─ section-core-stats.ts – UI für Identität, Kernwerte, Attribute & Listen.
├─ section-entries.ts    – Strukturierte Einträge (Traits/Aktionen/... ).
├─ section-spells-known.ts – Verwaltung bekannter Zauber.
└─ presets.ts            – Geteilte Konstanten für Dropdowns/Enums.
```
Unterstützende Utilities liegen in `shared/` (`token-editor`, `stat-utils`).

## Features & Hauptzuständigkeiten
- **Geführtes Dreispalten-Layout mit Navigation:** Header-Breadcrumb & Stepper halten den Workflow linear, jede Spalte scrollt unabhängig und der Footer liefert AC/HP/Passive/CR-Chips plus Aktionen (Abbrechen/Speichern/Vorschau) samt Validierungsstatus.【F:src/apps/library/create/creature/modal.ts†L44-L204】【F:src/app/css.ts†L49-L176】
- **Statblock-Basisdaten erfassen:** Größe, Typ, Gesinnung, AC, Initiative, HP, Hit Dice, Bewegungen, Proficiency Bonus, CR, XP.【F:src/apps/library/create/creature/section-core-stats.ts†L19-L74】【F:src/apps/library/core/creature-files.ts†L7-L74】
- **Attribute & Fertigkeiten mit Autofill:** Tabelle für STR–CHA inkl. Save-Proficiencies und Skills, automatische Modifikatorberechnung über gemeinsame Utilities.【F:src/apps/library/create/creature/section-core-stats.ts†L42-L132】【F:src/apps/library/create/shared/stat-utils.ts†L1-L33】
- **Freitext-Listen (Sinne/Sprachen/Speeds):** Token-Editor-Chips zur Verwaltung variabler Listenfelder.【F:src/apps/library/create/creature/section-core-stats.ts†L134-L149】
- **Defensive Listen & Ausrüstung:** Chip-Editoren für Resistances, Immunities, Vulnerabilities sowie ein Equipment-&-Notes-Textarea befüllen die neuen Felder im Statblock-Datentyp.【F:src/apps/library/create/creature/modal.ts†L104-L165】
- **Strukturierte Einträge für Traits/Aktionen:** Kategoriebezogene Karten mit Feldern für Art, Trefferwürfe, Schaden, Saves, Recharge und Markdown-Text, inkl. Auto-Berechnung aus Ability/Proficiency.【F:src/apps/library/create/creature/section-entries.ts†L8-L151】
- **Zauber-Verwaltung:** Typeahead-Auswahl bekannter Zauber mit Level-, Nutzungs- und Notizfeldern.【F:src/apps/library/create/creature/section-spells-known.ts†L8-L70】
- **Export als Markdown/YAML:** `statblockToMarkdown` schreibt strukturierte JSON/YAML-Felder (inkl. Resistances/Immunities/Vulnerabilities und Equipment-Notizen) für Frontmatter und geordnete Abschnittsausgabe.【F:src/apps/library/core/creature-files.ts†L55-L157】

## Statblock-Anforderungen (aus Referenzen)
- **Meta & Kampf-Hauptdaten:** Name, Größe, Kreaturentyp(+Tags), Gesinnung, AC, Initiative, HP/Hit Dice, Speed-Varianten.【F:References, do not delete!/rulebooks/Statblocks/11_Monsters.md†L5-L88】
- **Attributblock & Abgeleitete Werte:** STR–CHA, Modifikatoren, Saves, Skills, Resistances/Vulnerabilities, Immunitäten, Ausrüstung.【F:References, do not delete!/rulebooks/Statblocks/11_Monsters.md†L9-L118】
- **Sinne, Sprachen, CR/PB/XP:** Wahrnehmung & besondere Sinne, Sprachoptionen, Challenge Rating samt Proficiency Bonus & Erfahrungswerten.【F:References, do not delete!/rulebooks/Statblocks/11_Monsters.md†L10-L207】
- **Eingeteilte Aktionen:** Traits, Actions, Bonus Actions, Reactions, Legendary Actions sowie Nutzungs-/Recharge-Regeln und Spellcasting-Blocks.【F:References, do not delete!/rulebooks/Statblocks/11_Monsters.md†L210-L272】【F:References, do not delete!/rulebooks/Statblocks/12_MonstersA-Z.md†L26-L158】

## Was funktioniert bereits gut?
- **Klares Navigationsgerüst:** Breadcrumb, Stepper und Spaltenfokus lassen schnell zwischen Grundwerten, Details und Aktionen springen und halten den Namen live präsent.【F:src/apps/library/create/creature/modal.ts†L44-L128】
- **Wiederverwendbare UI-Hilfen:** Suche-fähige Dropdowns, Inline-Stepper und Token-Chips sorgen für schnelle Eingabe wiederkehrender Felder.【F:src/apps/library/create/creature/modal.ts†L118-L161】【F:src/apps/library/create/shared/token-editor.ts†L1-L63】
- **Automatik für Würfelwerte:** Treffer- und Schadenswerte lassen sich aus Ability + PB berechnen, wodurch Inkonsistenzen reduziert werden.【F:src/apps/library/create/creature/section-entries.ts†L68-L142】
- **Footer-Feedback:** Zusammenfassungschips & Warn-Badges zeigen fehlende Pflichtfelder an und deaktivieren Speichern, bis Mindestanforderungen erfüllt sind.【F:src/apps/library/create/creature/modal.ts†L168-L204】
- **Markdown-Ausgabe deckt Kernabschnitte ab:** Export generiert YAML, Tabellen und strukturierte Abschnittsgruppen gemäß Vorlage.【F:src/apps/library/core/creature-files.ts†L79-L157】

## Optimierungspotenzial
- **Condition Immunities & Sonderfelder ergänzen:** Referenz-Statblocks führen neben Damage-Resistances häufig Condition Immunities oder Traits wie „Damage Threshold“, die weiterhin fehlen.【F:References, do not delete!/rulebooks/Statblocks/11_Monsters.md†L98-L128】
- **Speed-Felder konsolidieren:** Sowohl einzelne `speedWalk/swim/...` als auch `speedList` existieren; ein einheitliches Modell würde UI-Logik vereinfachen.【F:src/apps/library/core/creature-files.ts†L19-L26】【F:src/apps/library/create/creature/modal.ts†L115-L162】
- **Abschnittsgewichtung verbessern:** Lange Listen (Skills, Einträge, Zauber) scrollen vertikal; Accordion- oder Tabs für „Offense/Defense/Spellcasting“ könnten Übersicht erhöhen ohne Informationen zu verstecken.【F:src/apps/library/create/creature/modal.ts†L44-L168】
- **Voreinstellungen & Presets ausbauen:** Beispielstatblocks zeigen konsistente Reihenfolge & Terminologie (z. B. Initiative in Klammern); UI könnte Templates/Preview nutzen.【F:References, do not delete!/rulebooks/Statblocks/12_MonstersA-Z.md†L5-L58】

## Layout-Blueprint für den Creature-Dialog

### 1. Grid & Navigation
- **Dialograhmen:** Fester Inhalt auf 1240 px Breite, 720 px Höhe; dreispaltiges CSS-Grid mit Spaltenbreiten 320 px · 360 px · flex (Rest). 24 px Innenabstand, 16 px Spaltengap für klare Blickführung.
- **Sektionensteuerung:** Accordion auf Desktop standardmäßig ausgeklappt, „Zurück/Weiter“-Stepper oberhalb des Footers für linearen Workflow. Breadcrumb-Titel zeigt Kreaturenname (live aktualisiert) zur Orientierung.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L1-L8】
- **Scrollverhalten:** Grid-Spalten scrollen unabhängig (overflow-y auto) mit Sticky-Section-Headern bei 48 px Höhe, damit lange Aktionslisten nicht Navigationselemente verdecken.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/vampire.md†L45-L64】

### 2. Linke Spalte – Identität & Kampf-Basics (320 px)
- **Identitätskarte (Spacing 12 px):**
  - `TextField` „Name“ (Label exakt so), Vollbreite, Pflichtfeld.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L1-L3】
  - Drei Dropdowns in 3×1 Grid (je 96 px): „Größe“, „Kreaturentyp“, „Gesinnung“, befüllt aus Presets; Formatierung entspricht Referenz (*z. B. “Gargantuan Dragon (Chromatic), Chaotic Evil”*).【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L3-L4】
- **Defensive & Initiativwerte (Zweispaltiges Grid 150 px + 150 px):**
  - AC (NumberField, Label „Armor Class“), HP (Hit Points, NumberField mit „(xdy + z)“-Textfeld daneben, 90 px), „Hit Dice“ (TextField).【F:References, do not delete!/rulebooks/Statblocks/Creatures/Animals/wolf.md†L5-L8】
  - Initiative (NumberField, Label „Initiative“ mit sekundärer Anzeige „(Modifikator)“ als Readonly-Chip).【F:References, do not delete!/rulebooks/Statblocks/Creatures/Animals/wolf.md†L9-L18】
- **Bewegungsarten:** Token-Chip-Editor über volle Breite, Label „Speed (ft.)“; jede Chip zeigt „Art · Wert“ (z. B. „Fly · 80“) zur Abbildung mehrerer Werte.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L5-L8】
- **Herausforderungsgrad:** Kartenabschnitt mit dreifachem Inline-Stack (je 96 px): „Challenge Rating“, „XP“, „Proficiency Bonus“, um CR-Ausgabe samt XP/PB sichtbar zu halten.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L23-L24】
- **Sprachen & Sinne:** Zweizeilige `Textarea`-Karte mit Tabs „Senses“ und „Languages“, Labels exakt wie im Statblock, inkl. passiver Wahrnehmung & Format „darkvision 120 ft.; Passive Perception 26“. Sticky-Helper-Text erinnert an semikolon-getrennte Darstellung.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L21-L22】

### 3. Mittlere Spalte – Werte, Defensive Listen & Ausrüstung (360 px)
- **Attributmatrix:** Fixierte Tabelle (Headerhöhe 40 px) mit sechs Zeilen (STR–CHA) und drei editierbaren Spalten „Score“, „Mod“, „Save“; „Mod“ wird berechnet & gesperrt, „Save“ Checkbox für Proficiency + Stepper. Zeilen-Label-Buttons öffnen Kontextmenü für abgeleitete Notizen.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Animals/wolf.md†L11-L18】
- **Skills & Fertigkeiten:** Accordion-Panel mit Filterbarer Liste (Zweispaltig 168 px). Jede Zeile: Checkbox „Proficient“, Badge zeigt automatischen Bonus (PB+Mod). Standardliste enthält Einträge wie „Perception +16, Stealth +9“. Sticky-Header „Skills“.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L19-L21】
- **Resistances/Immunities/Vulnerabilities:** Drei Chips-Stacks übereinander (Label exakt „Resistances“, „Immunities“, „Vulnerabilities“). Chips erlauben Typ + optionalen Kontext (z. B. „Sunlight – Disadvantage on attack rolls“).【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/vampire.md†L19-L40】
- **Ausrüstung & Besonderheiten:** `Textarea` „Equipment & Notes“ (3 Zeilen) für Gegenstände oder Sondernotizen, damit Schwächen wie „Stake to the Heart“ erfasst werden können.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/vampire.md†L34-L40】

### 4. Rechte Spalte – Aktionen, Fähigkeiten & Zauber (flex)
- **Traits-Sektion:** Wiederholbare Karten (Breite 100 % der Spalte) mit Feldern: „Titel“, „Verwendung“ (Dropdown: Passive, Recharge X-Y, Limited Use), „Beschreibung“ (Markdown-Editor). Unterstützt legendäre Widerstände wie im Vampir-Statblock.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/vampire.md†L25-L33】
- **Actions & Bonus/Reaction/Legendary Tabs:** Horizontaler Tab-Switcher (Actions · Bonus Actions · Reactions · Legendary · Lair). Jede Karte enthält strukturierte Felder:
  - Primärer Aktionsname („Multiattack“, „Bite“).【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/vampire.md†L45-L55】
  - Aktionsart (Dropdown: Melee Attack, Ranged, Save, Special) + Felder „Attack Bonus“, „Reach/Range“, „Target“.
  - Schadenstabelle (bis zu 3 Zeilen: Würfel-Notationsfeld + Schadenstyp).【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L34-L39】
  - Optionales „Save DC“ & Effekt-Editor, um Einträge wie „Dexterity Saving Throw: DC 22 …“ abzubilden.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L38-L39】
  - Recharge/Limited-Use-Badges (rechts oben) mit automatischem Anzeigeformat („Recharge 5–6“).【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/vampire.md†L58-L59】
- **Spellcasting Block:** Dedizierter Tab innerhalb der rechten Spalte mit Formular: oberer Bereich für Casting-Statistik („Spellcasting Ability“, „Save DC“, „Attack Bonus“), darunter Frequenz-Listen (At-Will, X/Day) mit Typeahead zur Auswahl der Zauber, Format übernimmt Aufzählungen wie bei Drachen.【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L40-L43】
- **Legendary Actions/Lair Actions:** Unter-Tabs innerhalb des Legendary-Bereichs ermöglichen separate Kartenlisten für Aktionen wie „Cloud of Insects“ oder „Beguile“, inkl. Beschreibungsfeld und Kosten-Badge (z. B. „Costs 2 Actions“).【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/ancient-black-dragon.md†L45-L51】【F:References, do not delete!/rulebooks/Statblocks/Creatures/Monsters/vampire.md†L60-L64】

### 5. Footer & Kontext-Tools
- **Sticky-Footer (68 px Höhe):** Links Zusammenfassung in Chips (AC, HP, Passive Perception, CR) zur schnellen Gegenprüfung, rechts Buttons „Abbrechen“, „Speichern“, „Vorschau öffnen“.
- **Validierungs-Hinweise:** Inline-Statusleisten innerhalb des Footers listen fehlende Pflichtfelder (z. B. Name, mindestens eine Aktion), damit der Export konform zu den Referenzstatblocks bleibt.

## Datei-Details
- **index.ts:** Bündelt Exporte für Modal und Section-Mounts, damit externe Aufrufer eine schlanke API nutzen.【F:src/apps/library/create/creature/index.ts†L1-L6】
- **modal.ts:** Baut Header mit Breadcrumb & Stepper, richtet Dreispaltenlayout samt Speed-/Entries-/Spells-Sektionen ein, erweitert die Mittelspalte um Resistances/Immunities/Vulnerabilities-Chips plus Equipment-&-Notes-Textarea, lädt Spell-Liste, zeigt Footer-Chips/Validierungen und öffnet bei Bedarf eine JSON-Vorschau.【F:src/apps/library/create/creature/modal.ts†L28-L210】
- **section-core-stats.ts:** Baut Identity-/Kernwerte-Form, Fähigkeitentabelle, Skill-Checkboxen und Token-Editoren für Sinne/Sprachen.【F:src/apps/library/create/creature/section-core-stats.ts†L19-L149】
- **section-entries.ts:** Rendert wiederholbare Karten für strukturierte Statblock-Einträge inklusive Auto-Berechnung und Markdown-Textbox.【F:src/apps/library/create/creature/section-entries.ts†L8-L151】
- **section-spells-known.ts:** Stellt Typeahead-Input bereit, verwaltet die gespeicherten Zauberobjekte und erzeugt Listenansicht mit Entfernen-Buttons.【F:src/apps/library/create/creature/section-spells-known.ts†L8-L70】
- **presets.ts:** Enthält Konstanten/Typen für Größen, Typen, Gesinnungen, Skills, Bewegungsarten und Dropdown-Befüllung, damit UI & Export konsistent bleiben.【F:src/apps/library/create/creature/presets.ts†L1-L67】
